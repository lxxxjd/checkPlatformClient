(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"y/3+":function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r,i,o,l=a("bx4M"),s=(a("g9YV"),a("wCAj")),c=(a("14J3"),a("BMrR")),p=(a("jCWc"),a("kPKH")),u=(a("+L6B"),a("2/Rp")),d=(a("5NDa"),a("5rEg")),f=(a("DZo9"),a("8z0m")),m=(a("Pwec"),a("CtXQ")),h=a("eHn4"),g=a.n(h),v=a("d6i3"),y=a.n(v),w=a("1l/V"),b=a.n(w),E=(a("/xke"),a("TeRw")),k=(a("miYZ"),a("tsqr")),C=(a("2qtc"),a("kLXV")),I=a("2Taf"),S=a.n(I),x=a("vZ4D"),D=a.n(x),F=a("l4Ni"),O=a.n(F),M=a("ujKo"),P=a.n(M),R=a("MhPg"),L=a.n(R),N=(a("y8nQ"),a("Vl3Y")),V=(a("OaEy"),a("2fM7")),Y=a("q1tI"),j=a.n(Y),z=a("MuoO"),B=a("Y2fQ"),J=a("zHco"),q=a("wd/R"),A=a.n(q),T=a("O02X"),U=a.n(T);function Q(e){return function(){var t,a=P()(e);if(H()){var n=P()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return O()(this,t)}}function H(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var K=V["a"].Option;function X(e){return new Promise(function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return a(e)}})}var Z=(n=N["a"].create(),r=Object(z["connect"])(function(e){var t=e.certificate,a=e.loading;return{certificate:t,loading:a.models.certificate}}),n(i=r((o=function(e){L()(a,e);var t=Q(a);function a(){var e;S()(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),e.state={visible:!1,previewVisible:!1,previewImage:"",fileList:[],authorusers:[],overallstate:void 0},e.columns=[{title:"\u8bc1\u4e66\u8bc1\u7a3f",dataIndex:"name",render:function(e){var t=/\.{1}[a-z]{1,}$/;return null!==t.exec(e)?j.a.createElement("span",null,e.slice(0,t.exec(e).index)):j.a.createElement("span",null,e)}},{title:"\u6388\u6743\u7b7e\u5b57\u65e5\u671f",dataIndex:"authordate",render:function(t){return e.isValidDate(t)}},{title:"\u6388\u6743\u7b7e\u5b57\u4eba",dataIndex:"authorNameC"},{title:"\u72b6\u6001\u65e5\u671f",render:function(t,a){return e.getStatusDate(t)}},{title:"\u72b6\u6001",dataIndex:"status"},{title:"\u64cd\u4f5c",render:function(t,a){return j.a.createElement(Y["Fragment"],null,"\u5df2\u7b7e\u7f72"===t.status&&null===t.pdfeditorpath?[j.a.createElement("a",{onClick:function(){return e.deleteItem(t,a)}},"\u5220\u9664\xa0\xa0")]:[],j.a.createElement("a",{onClick:function(){return e.ViewItem(t,a)}},"\u67e5\u770b\xa0\xa0"),"\u5df2\u4f5c\u5e9f"===t.status?[j.a.createElement("a",{onClick:function(){return e.viewAbandonItem(t,a)}},"\u4f5c\u5e9f\u539f\u56e0\xa0\xa0")]:[])}}],e.getStatusDate=function(e){var t=void 0;return"\u5f85\u62df\u5236"===e.status?t=e.uploaddate:"\u5df2\u62df\u5236"===e.status?t=e.signdate:"\u5df2\u590d\u6838"===e.status?t=e.reviewdate:"\u5df2\u7f2e\u5236"===e.status?t=e.makedate:"\u5df2\u7b7e\u7f72"===e.status?t=e.authordate:"\u5df2\u53d1\u5e03"===e.status?t=e.publishdate:"\u5df2\u4f5c\u5e9f"===e.status?t=e.abandondate:"\u7533\u8bf7\u4f5c\u5e9f"===e.status?t=e.applydate:"\u7533\u8bf7\u4f5c\u5e9f"===e.status&&(t=e.applydate),void 0===t?[]:j.a.createElement("span",null,A()(t).format("YYYY-MM-DD"))},e.isValidDate=function(e){return void 0!==e&&null!==e?j.a.createElement("span",null,A()(e).format("YYYY-MM-DD")):[]},e.viewAbandonItem=function(e){C["a"].info({title:"\u4f5c\u5e9f\u539f\u56e0",okText:"\u77e5\u9053\u4e86",content:j.a.createElement("div",null,j.a.createElement("p",null,e.abandonreason)),onOk:function(){}})},e.ViewItem=function(t){var a,n=e.props.dispatch;"\u5df2\u62df\u5236"===t.status?a=t.pdfeditorpath:"\u5df2\u590d\u6838"===t.status?a=t.pdfpath:"\u5df2\u7f2e\u5236"===t.status?a=t.titlepdfpath:"\u5df2\u7b7e\u7f72"===t.status||"\u5df2\u53d1\u5e03"===t.status?a=t.certpdfpath:"\u5df2\u4f5c\u5e9f"===t.status?a=t.abandonpdfpath:void 0!==a||void 0!==t.filepath&&null!==t.filepath||(a=t.certpdfpath),n({type:"certificate/getPdfByOssPath",payload:{osspath:a},callback:function(e){200===e.code?window.open(e.data):k["a"].success("\u6253\u5f00\u6587\u4ef6\u5931\u8d25")}})},e.deleteItem=function(t){var a=e.props.dispatch,n={keyno:t.keyno},r=sessionStorage.getItem("reportno");a({type:"certificate/deleteCertFile",payload:n,callback:function(e){400===e.code?E["a"].open({message:"\u5220\u9664\u5931\u8d25",description:e.data}):(E["a"].open({message:"\u5220\u9664\u6210\u529f",description:e.data}),a({type:"certificate/getCertFiles",payload:{reportno:r}}))}})},e.handleOk=function(){k["a"].success("\u6b63\u5728\u4e0a\u4f20\u8bc1\u4e66\uff0c\u8bf7\u7a0d\u7b49\u51e0\u79d2");var t=e.props,a=t.form.validateFieldsAndScroll,n=t.dispatch,r=sessionStorage.getItem("reportno"),i=JSON.parse(localStorage.getItem("userinfo"));a(function(t,a){if(!t){var o=new FormData;a.MultipartFile.fileList.forEach(function(e){o.append("file",e.originFileObj),o.append("size",e.size)}),o.append("creator",i.nameC),o.append("modifier",i.nameC),o.append("reportno",r),o.append("author",a.author),o.append("name",a.recordname),o.append("certcode",i.certCode),n({type:"certificate/uploadCertFilePdf",payload:o,callback:function(e){400===e.code?E["a"].open({message:"\u6dfb\u52a0\u5931\u8d25",description:e.data}):n({type:"certificate/getCertFiles",payload:{reportno:r}})}}),e.setState({visible:!1}),form.resetFields()}})},e.show=function(){var t=e.props.form;t.resetFields(),e.setState({fileList:[]}),e.setState({visible:!0})},e.handleCancel=function(){var t=e.props.form;t.resetFields(),e.setState({visible:!1})},e.onChange=function(t){"\u6309\u5355\u4ef7"===t.target.value||"\u6309\u6bd4\u4f8b"===t.target.value?e.setState({showPrice:!0}):e.setState({showPrice:!1})},e.Cancel=function(){return e.setState({previewVisible:!1})},e.handlePreview=function(){var t=b()(y.a.mark(function t(a){return y.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a.url||a.preview){t.next=4;break}return t.next=3,X(a.originFileObj);case 3:a.preview=t.sent;case 4:e.setState({previewImage:a.url||a.preview,previewVisible:!0});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(t){var a=t.file,n=t.fileList,r="application/pdf"===a.type,i="image/jpg"===a.type,o="image/jpeg"===a.type,l="image/png"===a.type,s=a.size/1024/1024<20;if(r||i||o||l)if(s){var c=a.name,p=/\.{1}[a-z]{1,}$/;null!==p.exec(c)&&(c=c.slice(0,p.exec(c).index));var u=e.props.form;u.setFieldsValue(g()({},"recordname",c)),e.setState({fileList:n})}else C["a"].error({title:"\u8d85\u8fc720M\u9650\u5236\uff0c\u4e0d\u5141\u8bb8\u4e0a\u4f20~"});else C["a"].error({title:"\u53ea\u80fd\u4e0a\u4f20PDF\u3001PNG\u3001JPG\u683c\u5f0f\u6587\u4ef6~"})},e.handleBeforeUpload=function(e){return!1},e.back=function(){e.props.history.goBack()},e.getRepeatName=function(t,a,n){void 0!==a&&null!==a&&""!==a||n(Object(B["formatMessage"])({id:"validation.certname.noexist"}));var r=e.props.dispatch,i=sessionStorage.getItem("reportno"),o=new FormData;o.append("reportno",i),o.append("name",a),r({type:"certificate/getRepeatName",payload:o,callback:function(e){"repeat"===e?n(Object(B["formatMessage"])({id:"validation.certname.repeat"})):"success"===e?n():n(Object(B["formatMessage"])({id:"validation.certname.error"}))}})},e}return D()(a,[{key:"componentDidMount",value:function(){var e=this,t=sessionStorage.getItem("overallstate_CertificateFinishedDetail");this.state.overallstate=t;var a=this.props.dispatch,n=sessionStorage.getItem("reportno");a({type:"certificate/getCertFiles",payload:{reportno:n}});var r=JSON.parse(localStorage.getItem("userinfo"));a({type:"user/getMan",payload:{certcode:r.certCode,func:"\u6388\u6743\u7b7e\u5b57"},callback:function(t){t?(0===t.length&&C["a"].info({title:"\u6388\u6743\u7b7e\u5b57\u4eba\u672a\u914d\u7f6e\uff01",content:"\u7f2e\u5236\u63d0\u4ea4\u9700\u63d0\u4ea4\u6388\u6743\u7b7e\u5b57\u4eba\uff0c\u8bf7\u7ba1\u7406\u5458\u5728\u201c\u516c\u53f8\u7ba1\u7406-\u7528\u6237\u7ba1\u7406\u201d\u7ed9\u7528\u6237\u4fee\u6539\u89d2\u8272\uff01\u7528\u6237\u4fee\u6539\uff0c\u5728\u662f\u5426\u4e3a\u6388\u6743\u7b7e\u5b57\u4eba\uff0c\u9009\u201c\u662f\u201d\u3002",okText:"\u77e5\u9053\u4e86",onOk:function(){}}),e.setState({authorusers:t})):k["a"].error("\u672a\u914d\u7f6e\u6388\u6743\u7b7e\u5b57\u7528\u6237\u89d2\u8272")}})}},{key:"render",value:function(){var e=j.a.createElement("div",null,j.a.createElement(m["a"],{type:"plus"}),j.a.createElement("div",{className:"ant-upload-text"},"Upload")),t=this.props,a=t.certificate.recordData,n=t.loading,r=t.form.getFieldDecorator,i=this.state,o=i.fileList,h=i.visible,g=i.previewVisible,v=i.previewImage,y=i.authorusers,w=y.map(function(e){return j.a.createElement(K,{key:e.userName,value:e.userName},e.nameC)}),b=sessionStorage.getItem("reportno"),E=sessionStorage.getItem("shipname"),k=sessionStorage.getItem("applicant"),I={reportno:b,shipname:E,applicant:k};return j.a.createElement(J["a"],{text:I},j.a.createElement(C["a"],{title:"\u8bc1\u4e66\u4e0a\u4f20",visible:h,onOk:this.handleOk,onCancel:this.handleCancel},j.a.createElement(N["a"],null,j.a.createElement(N["a"].Item,{label:"\u6587\u4ef6\u4e0a\u4f20"},r("MultipartFile",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u6587\u4ef6"}]})(j.a.createElement(f["a"],{listType:"picture-card",fileList:o,onPreview:this.handlePreview,beforeUpload:this.handleBeforeUpload,onChange:this.handleChange},o.length>=1?null:e))),j.a.createElement(N["a"].Item,{label:"\u8bc1\u4e66\u540d\u79f0"},r("recordname",{rules:[{required:!0,validator:this.getRepeatName}]})(j.a.createElement(d["a"],{style:{width:"100%"},placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u540d\u79f0,\u4e0d\u8d85\u8fc710\u4e2a\u5b57\u7b26",maxLength:10}))),j.a.createElement(N["a"].Item,{label:"\u6388\u6743\u7b7e\u5b57\u4eba"},r("author",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6388\u6743\u7b7e\u5b57\u4eba"}]})(j.a.createElement(V["a"],{style:{width:"100%"},placeholder:"\u8bf7\u9009\u62e9\u6388\u6743\u7b7e\u5b57\u4eba"},w))),j.a.createElement(C["a"],{visible:g,footer:null,onCancel:this.Cancel},j.a.createElement("img",{alt:"example",style:{width:"100%"},src:v})))),j.a.createElement(l["a"],{bordered:!1,size:"small"},j.a.createElement(c["a"],null,j.a.createElement(p["a"],{span:22},"\u5df2\u53d1\u5e03"===this.state.overallstate||"\u7533\u8bf7\u4f5c\u5e9f"===this.state.overallstate?[]:[j.a.createElement(u["a"],{style:{marginBottom:12},type:"primary",onClick:this.show},"\u4e0a\u4f20\u6587\u4ef6")]),j.a.createElement(p["a"],{span:2},j.a.createElement(u["a"],{type:"primary",style:{marginLeft:8,paddingLeft:0,paddingRight:15},onClick:this.back},j.a.createElement(m["a"],{type:"left"}),"\u8fd4\u56de"))),j.a.createElement("div",{className:U.a.tableList},j.a.createElement(s["a"],{size:"middle",loading:n,dataSource:a,columns:this.columns,rowKey:"name",pagination:{showQuickJumper:!0,showSizeChanger:!0}}))))}}]),a}(Y["PureComponent"]),i=o))||i)||i);t["default"]=Z}}]);