(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[93],{z6lU:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r,o,i,l=a("bx4M"),s=(a("g9YV"),a("wCAj")),c=(a("14J3"),a("BMrR")),p=(a("jCWc"),a("kPKH")),d=(a("+L6B"),a("2/Rp")),u=(a("5NDa"),a("5rEg")),m=(a("DZo9"),a("8z0m")),f=(a("Pwec"),a("CtXQ")),g=(a("miYZ"),a("tsqr")),h=a("eHn4"),v=a.n(h),w=(a("2qtc"),a("kLXV")),y=a("d6i3"),b=a.n(y),E=a("1l/V"),S=a.n(E),R=(a("/xke"),a("TeRw")),I=a("p0pE"),k=a.n(I),C=a("2Taf"),x=a.n(C),N=a("vZ4D"),D=a.n(N),V=a("MhPg"),F=a.n(V),M=a("l4Ni"),P=a.n(M),O=a("ujKo"),L=a.n(O),j=(a("y8nQ"),a("Vl3Y")),z=(a("OaEy"),a("2fM7")),J=a("q1tI"),Y=a.n(J),U=a("MuoO"),B=a("Y2fQ"),q=a("zHco"),A=a("wd/R"),G=a.n(A),Q=a("jyUc"),T=a.n(Q);function H(e){return function(){var t,a=L()(e);if(K()){var n=L()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return P()(this,t)}}function K(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var Z=z["a"].Option;function X(e){return new Promise(function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return a(e)}})}var $=(n=j["a"].create(),r=Object(U["connect"])(function(e){var t=e.testRecordEntrustment,a=e.loading;return{testRecordEntrustment:t,loading:a.models.testRecordEntrustment}}),n(o=r((i=function(e){F()(a,e);var t=H(a);function a(){var e;x()(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r)),e.state={visible:!1,downloadVisible:!1,previewVisible:!1,previewImage:"",fileList:[],modelName:[],url:null,showVisible:!1,text:{}},e.columns=[{title:"\u6587\u4ef6\u540d\u79f0",dataIndex:"recordname",render:function(e){var t=/\.{1}[a-z]{1,}$/;return null!==t.exec(e)?Y.a.createElement("span",null,e.slice(0,t.exec(e).index)):Y.a.createElement("span",null,e)}},{title:"\u4e0a\u4f20\u65e5\u671f",dataIndex:"recorddate",render:function(e){return Y.a.createElement("span",null,G()(e).format("YYYY-MM-DD"))}},{title:"\u4e0a\u4f20\u4eba",dataIndex:"creator"},{title:"\u64cd\u4f5c",render:function(t,a){return Y.a.createElement(J["Fragment"],null,Y.a.createElement("a",{onClick:function(){return e.previewItem(t,a)}},"\u6587\u4ef6\u8be6\u60c5"),"\xa0\xa0",Y.a.createElement("a",{onClick:function(){return e.deleteItem(t,a)}},"\u5220\u9664"),"\xa0\xa0")}}],e.previewItem=function(t){var a=e.props.dispatch,n=sessionStorage.getItem("reportno"),r=k()({},t,{reportno:n,source:"\u59d4\u6258"});a({type:"testRecordEntrustment/getRecord",payload:r,callback:function(t){if(400===t.code)R["a"].open({message:"\u6253\u5f00\u5931\u8d25",description:t.data});else{var a=t.data;e.setState({url:a})}}}),e.setState({showVisible:!0}),e.setState({text:t})},e.deleteItem=function(t){var a=e.props.dispatch,n=sessionStorage.getItem("reportno"),r=k()({},t,{reportno:n});a({type:"testRecordEntrustment/deleteRecordInfo",payload:r,callback:function(t){400===t.code?R["a"].open({message:"\u5220\u9664\u5931\u8d25",description:t.data}):e.componentDidMount()}})},e.handleOk=function(){var t=e.props,a=t.form.validateFieldsAndScroll,n=t.dispatch,r=sessionStorage.getItem("reportno");a(function(t,a){if(!t){var o=new FormData,i=JSON.parse(localStorage.getItem("userinfo"));a.MultipartFile.fileList.forEach(function(e){o.append("files",e.originFileObj)}),o.append("reportno",r),o.append("source","\u59d4\u6258"),o.append("fileName",a.recordname),o.append("creator",i.nameC),n({type:"testRecordEntrustment/uploadFile",payload:o,callback:function(t){400===t.code?R["a"].open({message:"\u6dfb\u52a0\u5931\u8d25",description:t.message}):e.componentDidMount()}}),e.setState({visible:!1}),form.resetFields()}})},e.show=function(){var t=e.props,a=t.form;t.dispatch,sessionStorage.getItem("reportno");a.resetFields(),e.setState({fileList:[]}),e.setState({visible:!0})},e.handleCancel=function(){var t=e.props.form;t.resetFields(),e.setState({visible:!1})},e.onChange=function(t){"\u6309\u5355\u4ef7"===t.target.value||"\u6309\u6bd4\u4f8b"===t.target.value?e.setState({showPrice:!0}):e.setState({showPrice:!1})},e.Cancel=function(){return e.setState({previewVisible:!1})},e.handlePreview=function(){var t=S()(b.a.mark(function t(a){return b.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a.url||a.preview){t.next=4;break}return t.next=3,X(a.originFileObj);case 3:a.preview=t.sent;case 4:e.setState({previewImage:a.url||a.preview,previewVisible:!0});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(t){var a=t.file,n=t.fileList,r="image/jpg"===a.type,o="image/jpeg"===a.type,i="image/gif"===a.type,l="image/png"===a.type,s="application/pdf"===a.type,c=a.size/1024/1024<20;if(r||o||i||l||s)if(c){var p=e.props.form,d=/\.{1}[a-z]{1,}$/;p.setFieldsValue(v()({},"recordname",a.name.slice(0,d.exec(a.name).index))),e.setState({fileList:n})}else w["a"].error({title:"\u8d85\u8fc720M\u9650\u5236\uff0c\u4e0d\u5141\u8bb8\u4e0a\u4f20~"});else w["a"].error({title:"\u53ea\u80fd\u4e0a\u4f20JPG \u3001JPEG \u3001GIF\u3001 PNG\u3001 PDF\u683c\u5f0f\u7684\u56fe\u7247~"})},e.handleBeforeUpload=function(e){return!1},e.showDownloadVisible=function(t){e.setState({downloadVisible:!!t})},e.handleDownloadCancel=function(t){e.setState({downloadVisible:!!t})},e.handleDownloadAdd=function(t){var a=e.props.dispatch,n=sessionStorage.getItem("reportno"),r={reportno:n,tempName:t.tempName,recordName:t.downloadRecordName};a({type:"testRecordEntrustment/downloadPlatFromTemp",payload:r,callback:function(e){e&&g["a"].success("\u4e0b\u8f7d\u6210\u529f")}}),e.setState({downloadVisible:!1})},e.handleOnSelect=function(t){var a=JSON.parse(localStorage.getItem("userinfo")),n="";n="platform"===t?"platform":"company"===t?a.certCode:"person"===t?a.userName:"blank";var r=e.props.dispatch,o={type:t,owner:n};r({type:"testRecordEntrustment/getModelName",payload:o,callback:function(t){t&&(e.state.modelName=t)}})},e.getRepeatRecordName=function(t,a,n){void 0!==a&&null!==a&&""!==a||n(Object(B["formatMessage"])({id:"validation.recordinfo.noexist"}));var r=e.props.dispatch,o=sessionStorage.getItem("reportno"),i=new FormData;i.append("reportno",o),i.append("recordname",a),i.append("source","\u59d4\u6258"),r({type:"recordinfo/getRepeatRecordName",payload:i,callback:function(e){"repeat"===e?n(Object(B["formatMessage"])({id:"validation.recordinfo.repeat"})):"success"===e?n():n(Object(B["formatMessage"])({id:"validation.recordinfo.error"}))}})},e.back=function(){e.props.history.goBack()},e.showCancel=function(){e.setState({showVisible:!1})},e}return D()(a,[{key:"componentDidMount",value:function(){var e=this.props.dispatch,t=sessionStorage.getItem("reportno");e({type:"testRecordEntrustment/getRecordInfo",payload:{reportno:t,source:"\u59d4\u6258"}})}},{key:"render",value:function(){var e=Y.a.createElement("div",null,Y.a.createElement(f["a"],{type:"plus"}),Y.a.createElement("div",{className:"ant-upload-text"},"Upload")),t=this.props,a=t.testRecordEntrustment.recordData,n=t.loading,r=t.form.getFieldDecorator,o=this.state,i=o.fileList,g=o.visible,h=o.previewVisible,v=o.previewImage,y=(o.downloadVisible,o.modelName),b=o.url,E=o.showVisible,S=(y.map(function(e){return Y.a.createElement(Z,{key:e,value:e},e)}),sessionStorage.getItem("reportno")),R=sessionStorage.getItem("shipname"),I=sessionStorage.getItem("applicant"),k={reportno:S,shipname:R,applicant:I};return Y.a.createElement(q["a"],{text:k},Y.a.createElement(w["a"],{title:"\u6587\u4ef6\u4e0a\u4f20",visible:g,onOk:this.handleOk,onCancel:this.handleCancel},Y.a.createElement(j["a"],null,Y.a.createElement(j["a"].Item,{label:"\u6587\u4ef6\u4e0a\u4f20"},r("MultipartFile",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u6587\u4ef6"}]})(Y.a.createElement(m["a"],{listType:"picture-card",fileList:i,onPreview:this.handlePreview,beforeUpload:this.handleBeforeUpload,onChange:this.handleChange},i.length>=1?null:e))),Y.a.createElement(j["a"].Item,{label:"\u6587\u4ef6\u540d\u79f0"},r("recordname",{rules:[{required:!0,validator:this.getRepeatRecordName}]})(Y.a.createElement(u["a"],{style:{width:"100%"},placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u540d\u79f0"}))),Y.a.createElement(w["a"],{visible:h,footer:null,onCancel:this.Cancel},Y.a.createElement("img",{alt:"example",style:{width:"100%"},src:v})))),Y.a.createElement(l["a"],{bordered:!1,size:"small"},Y.a.createElement(c["a"],null,Y.a.createElement(p["a"],{span:22},Y.a.createElement(d["a"],{style:{marginBottom:12},type:"primary",onClick:this.show},"\u4e0a\u4f20\u6587\u4ef6")),Y.a.createElement(p["a"],{span:2},Y.a.createElement(d["a"],{type:"primary",style:{marginLeft:8,paddingLeft:0,paddingRight:15},onClick:this.back},Y.a.createElement(f["a"],{type:"left"}),"\u8fd4\u56de"))),Y.a.createElement("div",{className:T.a.tableList},Y.a.createElement(s["a"],{size:"middle",loading:n,dataSource:a,columns:this.columns,rowKey:"recordname",pagination:{showQuickJumper:!0,showSizeChanger:!0}}))),Y.a.createElement(w["a"],{title:"\u8bb0\u5f55\u8be6\u60c5",visible:E,onCancel:this.showCancel,footer:null,width:800,style:{top:10}},Y.a.createElement("embed",{src:b,width:"700",height:"700",type:"application/pdf"})))}}]),a}(J["PureComponent"]),o=i))||o)||o);t["default"]=$}}]);